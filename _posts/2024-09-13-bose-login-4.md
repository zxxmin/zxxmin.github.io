---
title: ì†Œì…œë¡œê·¸ì¸ ì—°ë™ â†’ ë„¤ì´ë²„ 2
date: 2024-09-13 00:00:02
permalink: /toy/bose/login-naver-2
categories:
  - Toy project
  - BOSE
tag:
  - Toy project
  - BOSE
---

# ë¡œê·¸ì¸ ì„±ê³µ í˜ì´ì§€
- ë¡œê·¸ì¸ ì„±ê³µ í›„ Redirect ëœ urlì—ì„œ **í† í° ê°’ ë°›ê¸°**
    - í† í°ìœ¼ë¡œ **ì‚¬ìš©ìì˜ ì •ë³´** ê°€ì ¸ì˜´

## í† í° ê°’ ê°€ì ¸ì˜¤ê¸°
ë¡œê·¸ì¸ ì„±ê³µ í›„ Redirect ëœ urlì— # (hash)ë¡œ access_token ê°’ì„ ì£¼ê³  ìˆìŒ.

![](/assets/images/toy/bose_loginnaver_6.png)

```javascript
const getNaverToken = async () => {
    if(!location.hash) return;
    const token = location.hash.split('=')[1].split('&')[0];
    console.log(token);
}
```
![](/assets/images/toy/bose_loginnaver_7.png)

í† í° ê°’ ë°›ê¸° ì™„ë£Œ.

## ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
ë„¤ì´ë²„ APIë¥¼ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ. â†’ [ì°¸ê³  ë¸”ë¡œê·¸](https://developers.naver.com/docs/login/devguide/devguide.md#3-4-5-ì ‘ê·¼-í† í°ì„-ì´ìš©í•˜ì—¬-í”„ë¡œí•„-api-í˜¸ì¶œí•˜ê¸°)<br/>
ë‚´ê°€ ëª»ì°¾ëŠ”ê±´ì§€ ëª¨ë¥´ê² ì§€ë§Œ,, ê°œë°œ ê°€ì´ë“œ ì°¾ëŠ”ê²Œ ì¡°ê¸ˆ ì–´ë ¤ì› ìŒ ã…œã…œ

```javascript
try {
    const response = await fetch('https://openapi.naver.com/v1/nid/me', {
        method: 'GET',
        headers: {
            Authorization: `Bearer ${token}`
        },
    })

    const naverUser = await response.json();
    const username = naverUser.response.name
    setUsername(username);
    setLoading(false);
} catch (err) {
    console.error(err);
    setError('Error fetching user data');
    setLoading(false);
}
```
fetchì—ì„œ ê³„ì† ì˜¤ë¥˜ê°€ ë–´ë‹¤. fetch í•  ìˆ˜ ì—†ë‹¤â€¦?

### fetch í•  ìˆ˜ ì—†ëŠ” ì´ìœ 
ì›ë˜ëŠ” tokenì˜ ë¬¸ì œê°€ 1ìˆœìœ„ ì´ê² ì§€ë§Œ, ì½˜ì†”ì—ë„ í† í°ì´ ì˜ ë‚˜ì˜¤ê³  ìˆì–´ì„œ ìƒê°í•´ë³´ê¸°ì— **CORS ì˜¤ë¥˜**ì´ì§€ ì•Šì„ê¹Œ ìƒê°.<br/>
ê·¸ë˜ì„œ í”„ë¡ì‹œ ì„œë²„ë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•„ë´„

```javascript
// vite.config.js
export default defineConfig({
    // ...
    
    server: {
        proxy: {
            '/api/naver': {
                  target: 'https://openapi.naver.com',
                  changeOrigin: true,
                  rewrite: (path) => path.replace(/^\/api\/naver/, '')
            }
        }
    }
});
```

```javascript
try {
    const response = await fetch('/api/naver/v1/nid/me', {
        method: 'GET',
        headers: {
            Authorization: `Bearer ${token}`
        },
    })

    // ...
}
catch(e) {
    console.error(e);
}
```

vite.confing.js ì—ì„œ **serverì— proxy ë¥¼ ì„¤ì •**í•´ì£¼ê³  **â€˜/api/naver/v1/nid/meâ€™ í˜¸ì¶œ**í•´ì£¼ë‹ˆê¹Œ ê°’ì´ ì˜ ë„˜ì–´ì˜´.

![](/assets/images/toy/bose_loginnaver_8.png)

ì„±ê³µ!

SuccessLoing.jsx ì— ì¹´ì¹´ì˜¤, ë„¤ì´ë²„ ë‘˜ë‹¤ ì„¤ì •ì„ í•´ì£¼ë‹¤ë³´ë‹ˆê¹Œ ì½”ë“œê°€ ì§€ì €ë¶„í•´ì ¸ì„œ ì •ë¦¬ë¥¼ ë‹¤ì‹œ í•˜ì˜€ìŒ.

```javascript
// SucessLoing.jsx
const getKakaoToken = async () => {
    try {
        // ì¹´ì¹´ì˜¤ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­
        const response = await fetch('https://kauth.kakao.com/oauth/token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                grant_type: 'authorization_code',
                client_id: 'REST_API_KEY',
                redirect_uri: REDIRECT_URI,
                code: code,
            }),
        });

        const data = await response.json();
        const accessToken = data.access_token;

        // ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ ìš”ì²­
        const userResponse = await fetch('https://kapi.kakao.com/v2/user/me', {
            headers: {
                Authorization: `Bearer ${accessToken}`,
                'Content-type': 'application/x-www-form-urlencoded;charset=utf-8',
            },
        });

        const userData = await userResponse.json();
        const username = userData.kakao_account.profile.nickname;

        setUsername(username);
        setLoading(false);
    } catch (err) {
        console.error(err);
        setError('Error fetching user data');
        setLoading(false);
    }
};

const getNaverToken = async () => {
    if(!location.hash) return;
    // ì•¡ì„¸ì„œ í† í° ì¶”ì¶œ
    const token = location.hash.split('=')[1].split('&')[0];
    console.log(token);

    try {
        // ë„¤ì´ë²„ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ ìš”ì²­
        const response = await fetch('/api/naver/v1/nid/me', {
            method: 'GET',
            headers: {
                Authorization: `Bearer ${token}`
            },
        })

        const naverUser = await response.json();
        const username = naverUser.response.name
        setUsername(username);
        setLoading(false);
    } catch (err) {
        console.error(err);
        setError('Error fetching user data');
        setLoading(false);
    }
}

useEffect(() => {
    if (code) {
        getKakaoToken();
    } else {
        getNaverToken();
    }
}, [code]);

if (loading) {
    return <CenteredMessage message="Loading..." />;
}

if (error) {
    return <CenteredMessage message={error} />;
}

return(
    <>
    <div style={{margin: '0 auto 50px', paddingTop: '100px', textAlign: 'center'}}>
        <strong>{code ? 'ì¹´ì¹´ì˜¤' : 'ë„¤ì´ë²„'} ë¡œê·¸ì¸ ì„±ê³µ</strong>
        <p><strong>{username}</strong>ë‹˜ ë°˜ê°‘ìŠµë‹ˆë‹¤.</p>
    </div>
    {code
        ? <Button
            onClick={() => nav('/')}
            type={'func'}
            text={'ë©”ì¸ìœ¼ë¡œ ê°€ê¸°'}
          />
        : ''
    }
    </>
)


// SuccessLogin í•¨ìˆ˜ ë°–ì—
const CenteredMessage = ({ message }) => (
    <div style={{ margin: '0 auto 50px', padding: '100px', textAlign: 'center' }}>
        <p>{message}</p>
    </div>
);
```

# í‰ê°€
ì—­ì‹œ í•œë²ˆì— ì†ì‰½ê²Œ ë  ë¦¬ê°€ ì—†ë‹¤. ğŸ¤£ğŸ¤£ğŸ¤£<br/>
ê¸€ë¡œ ì“°ë ¤ë‹ˆ ë­”ê°€ ì§§ê³  ì‰¬ì›Œë³´ì´ì§€ë§Œ, API ë°œê¸‰ì„ í•˜ê³  ì—°ë™ì„ í•˜ëŠ” ê²ƒë¶€í„° ë¡œê·¸ì¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ ê¹Œì§€â€¦<br/>
ê·¸ë˜ë„ ì—­ì‹œ í•´ë‚´ë‹ˆê¹Œ ë¿Œë“¯í•˜ê³  ì¬ë¯¸ìˆë‹¤.<br/>
ì²œì²œíˆ êµ¬ê¸€ì´ë‚˜ í˜ì´ìŠ¤ë¶ ë“± ë‹¤ì–‘í•œ ì†Œì…œë¡œê·¸ì¸ ì—°ë™ì„ í•´ë´ì•¼ê² ë‹¤.

[ì°¸ê³  ë¸”ë¡œê·¸ - ë„¤ì´ë²„ ë¡œê·¸ì¸ ê°œë°œê°€ì´ë“œ](https://developers.naver.com/docs/login/devguide/devguide.md)<br/>
[ì°¸ê³  ë¸”ë¡œê·¸ - ë¦¬ì•¡íŠ¸ë¡œ ë„¤ì´ë²„ ì†Œì…œ ë¡œê·¸ì¸ ì ìš©í•˜ê¸°](https://velog.io/@rxxdo/ë¦¬ì•¡íŠ¸ë¡œ-ë„¤ì´ë²„-ì†Œì…œ-ë¡œê·¸ì¸-ì ìš©í•˜ê¸°-1ë¶€-ë„¤ì•„ë¡œ-ì ìš©í•˜ê¸°)<br/>
[ì°¸ê³  ë¸”ë¡œê·¸ - React ë„¤ì•„ë¡œ](https://velog.io/@sssssssssy/ë„¤ì´ë²„ë¡œê·¸ì¸)<br/>
[ì°¸ê³  ë¸”ë¡œê·¸ - ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸í•˜ì—¬, ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°](https://2mojurmoyang.tistory.com/193#2.4.1.%20%EB%A1%9C%EA%B7%B8%EC%9D%B8%20%EC%83%81%ED%83%9C%20%ED%99%95%EC%9D%B8%ED%95%98%EC%97%AC,%20%EC%82%AC%EC%9A%A9%EC%9E%90%20%EC%A0%95%EB%B3%B4%20%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0)