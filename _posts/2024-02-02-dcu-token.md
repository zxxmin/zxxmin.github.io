---
title: ğŸª ë¶ˆí•„ìš”í•œ í† í° í˜¸ì¶œ ë°©ì§€
date: 2024-02-02 00:00:01
permalink: /dcu/setToken
categories:
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- ë‹¤ì±„ì›€
tag:
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- ë‹¤ì±„ì›€
---

# ê°œìš”
- í† í°ì´ ìœ íš¨ì‹œê°„ì„ ê°€ì§€ê³  ìˆì–´ ì¿ í‚¤ì— ë‹´ì•„ ë³´ê´€í•˜ê³  ìˆìŒì—ë„ **í˜ì´ì§€ ì§„ì… ì‹œ ìƒˆë¡œìš´ í† í° ê°’ì„ í˜¸ì¶œ**í•˜ê³  ìˆê³ , **ê°™ì€ APIë¥¼ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ ì§„ì… ì‹œì—ë„ 
  ìƒˆë¡œìš´ í† í° ê°’ì„ í˜¸ì¶œ**í•˜ê³  ìˆëŠ” ë¬¸ì œ ë°œê²¬.

> í† í°ì„ ì¿ í‚¤ì— ë‹´ì€ ì´ìœ <br/>
  ì¼ë°˜ì ìœ¼ë¡œ í† í°ì„ ì €ì¥í•˜ëŠ” ì €ì¥ì†ŒëŠ” localStorageì™€ cookie ê°€ ìˆë‹¤.<br/>
  ì¿ í‚¤ë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” XSS ê³µê²©ì— ì·¨ì•½í•œ localStorage ë³´ë‹¤ ìƒëŒ€ì ìœ¼ë¡œ ì•ˆì „í•´ì„œ ì„ íƒí•˜ê²Œ ë˜ì—ˆë‹¤.  

  [Cookie VS LocalStorage](/cs%20ì§€ì‹/etc/2024/02/05/cookie&localstorage/)

# ë¶„ì„
- ë¡œì§ì˜ ë¬¸ì œ

## ìµœì´ˆ ë¡œì§
1. ì±… ì°¾ê¸° í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ê°’ í˜¸ì¶œí•˜ëŠ” API í†µì‹ 
2. í˜¸ì¶œëœ ê°’ì„ ì¿ í‚¤ì— ì €ì¥
3. ì¿ í‚¤ì— í† í°ì´ ìˆìœ¼ë©´ ì¿ í‚¤ì— ë‹´ê²¨ ìˆëŠ” í† í° ê°’ return
4. ì¿ í‚¤ì— í† í°ì´ ì—†ìœ¼ë©´ í† í° ê°’ í˜¸ì¶œí•˜ëŠ” API í˜¸ì¶œí•˜ì—¬ í† í° ê°’ return

í† í°ì´ ìœ íš¨ì‹œê°„ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ì¿ í‚¤ì— ë‹´ì•„ í† í°ì´ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ë¥¼ ìœ ë¬´ íŒŒì•…í•˜ëŠ” ê²ƒì¸ë°, 
ìœ„ ë°©ì‹ëŒ€ë¡œ í•˜ë©´ ì¿ í‚¤ì— í† í° ìœ ë¬´ë¥¼ íŒŒì•…í•˜ëŠ” ë¡œì§ì´ í† í° API í˜¸ì¶œì„ í•œ í›„ì— ìˆìœ¼ë‹ˆ, **í† í° ìœ íš¨ì‹œê°„ì´ ë§Œë£Œê°€ ë˜ì§€ ì•Šì•˜ìŒì—ë„ ë¶ˆêµ¬í•˜ê³  í† í°ì„ í˜¸ì¶œ**í•˜ê³  ìˆì–´ì„œ 
**ì„œë²„ì™€ì˜ ë¶ˆí•„ìš”í•œ í†µì‹ **ì„ í•˜ê³  ìˆìœ¼ë©°, ì¿ í‚¤ì— ë‹´ì•„ í† í°ì˜ ìœ ë¬´ë¥¼ íŒŒì•…í•˜ëŠ” ë¡œì§ ìì²´ê°€ ì“¸ëª¨ê°€ ì—†ëŠ” ì½”ë“œì˜€ë‹¤. ê·¸ëƒ¥ íë¦„ ìì²´ê°€ ì—‰ë§ì´ì˜€ë‹¤.

# í•´ê²° ë°©ë²•
- ë¡œì§ ìˆ˜ì •

## ë¡œì§ ìˆ˜ì •
1. í˜ì´ì§€ ì§„ì… ì‹œ ì¿ í‚¤ì— í† í° ê°’ì´ ìˆëŠ”ì§€ í™•ì¸.
2. ì¿ í‚¤ì— í† í°ì´ ìˆìœ¼ë©´ ì¿ í‚¤ì— ì €ì¥ëœ í† í° ê°’ return
3. ì¿ í‚¤ì— í† í°ì´ ì—†ìœ¼ë©´ í† í° ê°’ í˜¸ì¶œí•˜ëŠ” API í†µì‹  í›„ ì¿ í‚¤ì— ì €ì¥í•˜ê³ , ì¿ í‚¤ì— ì €ì¥ëœ í† í° ê°’ return

â†’ ì“¸ëª¨ ì—†ëŠ” ë¡œì§ì„ ì¤„ì´ê¸° ìœ„í•´ **ì§„ì…ë¶€í„° ì¿ í‚¤ì— í† í°ì´ ìˆëŠ”ì§€ë¥¼ í™•ì¸**í•˜ëŠ” ë¡œì§ìœ¼ë¡œ ë³€ê²½í–ˆë‹¤.

```javascript
// í† í° í˜¸ì¶œí•˜ëŠ” API
const tokenAPI = async () => {

    return await fetch('/api/v1/millie/oauth2/token.json', {
        method: 'POST',

    }).then(response => response.json())
        .then((result) => result.access_token);
}

// í† í°ì„ cookieì— ì €ì¥
const saveToken = (tokenResponse) => {
    const token = tokenResponse;

    const expiresDate = new Date();
    expiresDate.setMilliseconds(270000);

    const cookieString = `token=${token}; path=/; Max-Age=240;`;

    return document.cookie = cookieString;
}

// í† í°ì´ ìˆëŠ”ì§€ í™•ì¸
const checkToken = async () => {

    const cookies = document.cookie.split(';');

    let tokenValue;

    for (let i = 0; i < cookies.length; i++) {
        const cookieValue = cookies[i].trim();

        // cookieValueì— tokenì´ ìˆê³  || 'token=' ì´í›„ì˜ ê°’ì„ ì°¾ìŒ
        if(cookieValue.startsWith('token=')) {
            tokenValue = cookieValue.substring('token='.length);
        }
    }

    if (tokenValue === null || tokenValue === '' || typeof tokenValue === 'undefined') {
        tokenValue = await tokenAPI();
        saveToken(tokenValue);
    }

    return tokenValue;

}
```

## Class ë¬¸ë²•ìœ¼ë¡œ ë¦¬íŒ©í† ë§
ë‹¤ì±„ì›€ ì‘ì—…ì„ ì‹œì‘í•  ë•Œ ë‹´ë‹¹ë‹˜ê»˜ì„œ ë³´ì•ˆì„ ì¤‘ì ìœ¼ë¡œ ë‘” ['ì‹œíì–´ì½”ë”©'](https://www.kisa.or.kr/2060204/form?postSeq=14&page=1)ì´ë¼ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ì…¨ë‹¤.<br/>
ë³´ì•ˆ ì¸¡ë©´ì—ì„œ ì•ˆì „í•œ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ” 7ê°œì˜ ìœ í˜• ì¤‘ **'ìº¡ìŠí™”'** ë¥¼ í•˜ê¸° ìœ„í•´ ê³µë¶€ ì°¨ì›ìœ¼ë¡œ Class ë¬¸ë²•ìœ¼ë¡œ ë¦¬íŒ©í† ë§ í•´ë³´ì•˜ë‹¤.

```javascript
class GetToken {
    async getToken() {
        const tokenAPI = async () => {
            return await fetch('/api/v1/millie/oauth2/token.json', {
                method: 'POST',

            })
                .then(response => response.json())
                .then((result) => result.access_token);
        }


        const saveToken = (tokenResponse) => {
            const cookieString = `token=${tokenResponse}; path=/; Max-Age=240;`;

            return document.cookie = cookieString;
        }


        const checkToken = async () => {

            const cookies = document.cookie.split(';');

            let tokenValue;

            for (let i = 0; i < cookies.length; i++) {
                const cookieValue = cookies[i].trim();

                if(cookieValue.startsWith('token=')) {
                    tokenValue = cookieValue.substring('token='.length);
                }
            }

            if (tokenValue === null || tokenValue === '' || typeof tokenValue === 'undefined') {
                tokenValue = await tokenAPI();
                saveToken(tokenValue);
            }

            return tokenValue;

        }


        return await checkToken();
    }
}

const GET_TOKEN = new GetToken();
```

# ê²°ê³¼
ë¡œì§ ë³€ê²½ìœ¼ë¡œ **ë¶ˆí•„ìš”í•œ ì„œë²„ì˜ í˜¸ì¶œì´ ëŒ€í­ ê°ì†Œ**í–ˆë‹¤. ìœ íš¨í•œ ì‹œê°„ì´ ìˆìŒì—ë„ ì œëŒ€ë¡œ í™œìš©í•˜ì§€ ì•Šê³ , ì¿ í‚¤ì— ì €ì¥ë§Œ í•œë‹¤ê³  ëì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆë‹¤. 
ë³€ê²½ ì „ ì½”ë“œì™€ ë³€ê²½ í›„ ì½”ë“œë¥¼ ë‘ê³  ë¹„êµë¥¼ í•´ë³´ì•˜ë‹¤. ë¶ˆí•„ìš”í•œ ìˆœì„œì˜€ëŠ”ê°€ ì•„ë‹ˆë©´ í•„ìš”í•œ ìˆœì„œì˜€ëŠ”ê°€. íë¦„ì„ ì˜ ìƒê°í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ê² ë‹¤.
